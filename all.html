<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divine Cell Phone Services</title>
    <link href="img/Devine Phones.png" rel="icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"><link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-c3wMPtLoYkMhLJsyR5R9EjqoGy0e70+iOSNUmPyE6x/TGm0ZU6C/Hca6M9o6rNRCC6dngyFg2DVo5AZHnt1aJw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>

<!-- partial:index.partial.html -->
<body></body>
<header>
  <div class="nav-wrapper">
      <div class="logo-container">
          <img class="logo" src="img/Devine Phones.png" alt="Logo">
      </div>
      <nav>
          <input class="hidden" type="checkbox" id="menuToggle">
          <label class="menu-btn" for="menuToggle">
              <div class="menu"></div>
              <div class="menu"></div>
              <div class="menu"></div>
          </label>
          <div class="nav-container">
              <ul class="nav-tabs">
                <li class="nav-tab"><a href="./index.html">Home</a></li>
                
                <li class="nav-tab"><a href="./contact.html">Contact Us</a></li>
              
                  
              </ul>
          </div>
      </nav>

     
      
  </div>

  <script>
    // Request permission for notifications
if (Notification.permission !== "granted") {
  Notification.requestPermission().then((permission) => {
    if (permission === "granted") {
      console.log("Notification permission granted.");
    }
  });
}

  </script>
      
</header>


  <div id="orders-container"></div>
<main>
<center>
    <div class="profile-card">
      <img class="profile-img" src="img/Devine Phones.png" alt="ABBAH GADGETS Admin">
      <h2 class="profile-name">DIVINE CELLPHONE SERVICES</h2>
      <p class="profile-title">CEO</p>
      <ul class="profile-details">
        <li><i class="fa fa-phone"></i> +(256) 759-740-405</li>
            <li><i class="fa fa-phone"></i> +(256) 776-871-112</li>
        <li><i class="fa fa-envelope"></i> abbahgadgets@gmail.com</li>
        <li><i class="fa fa-map-marker"></i> Kampala, Uganda</li>
      </ul>
    </div>
    </center>
     <div class="news-heading">
    <p >WELCOME DIVINE CELLPHONE SERVICES</p>
   <h2 id="phone">MANAGE YOUR SITE HERE...</h2>       
    </div>

    <div class="card3-container">
      <div class="card3">
        <a href="brandnew.html">
          <div class="card3-content">
         
           <h2>Brand New Phones</h2>
          </div>
        </a>
      </div>
    
      <div class="card3">
        <a href="ukused.html">
          <div class="card3-content">
            
           
          <h2>UK Used Phones</h2>
          </div>
        </a>
      </div>
    
      <div class="card3">
        <a href="tvs.html">
          <div class="card3-content">
                  <h2>TVs</h2>
          </div>
        </a>
      </div>
    
      <div class="card3">
        <a href="sound.html">
          <div class="card3-content">
          
  
              <h2>Sound Gadgets</h2>
          </div>
        </a>
      </div>
    
      <div class="card3">
        <a href="accessories.html">
          <div class="card3-content">

            <h2>Accessories</h2>
          </div>
        </a>
      </div>
    
     
    
    
      <div class="card3">
        <a href="tablet.html">
          <div class="card3-content">
               <h2>Tablets</h2>
          </div>
        </a>
      </div>
    </div>
    


</div>
</section>

</main>

<script type="module" src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";
  import { getDatabase, ref, get, onValue, push,set, child } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAisBpwnYt14S4NiLbcOiAhdINsqwSYJiI",
  authDomain: "aleveltv-75194.firebaseapp.com",
  databaseURL: "https://aleveltv-75194-default-rtdb.firebaseio.com",
  projectId: "aleveltv-75194",
  storageBucket: "aleveltv-75194.appspot.com",
  messagingSenderId: "440342498130",
  appId: "1:440342498130:web:20e2eb670b1cb2c39cc88b",
  measurementId: "G-VTR1KGT4CW"
  };


const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

    // Request permission for notifications
if (Notification.permission !== 'granted') {
  Notification.requestPermission();
}

// Retrieve the orders from Firebase
const ordersRef = ref(database, "orders");

// Attach a listener to the "value" event to get the orders data
onValue(ordersRef, (snapshot) => {
  const ordersData = snapshot.val();

  const ordersContainer = document.getElementById("orders-container");
  ordersContainer.innerHTML = "";

  // Create an array to hold the sorted orders
  const sortedOrders = [];

  for (const orderId in ordersData) {
    sortedOrders.push({
      orderId,
      order: ordersData[orderId]
    });
  }

  // Sort the orders by timestamp in descending order
  sortedOrders.sort((a, b) => b.order.timestamp - a.order.timestamp);

  for (const sortedOrder of sortedOrders) {
    const orderId = sortedOrder.orderId;
    const order = sortedOrder.order;

    const orderContainer = document.createElement("div");
    orderContainer.classList.add("order-container");

    const orderTitle = document.createElement("h3");
    orderTitle.classList.add("order-title");
    orderTitle.textContent = `Order ID: ${orderId}`;

    const shareButton = document.createElement("button");
    shareButton.classList.add("share-button");
    shareButton.textContent = "Share on WhatsApp";
    shareButton.addEventListener("click", () => {
      // Share the order information via WhatsApp
      const orderText = `Order ID: ${orderId}\n` +
        `Order Date: ${order.orderDate}\n` +
        `Order Time: ${order.orderTime}\n` +
        `Customer Name: ${order.customerName}\n` +
        `Phone Number: ${order.phoneNumber}\n` +
        `Delivery Place: ${order.deliveryPlace}\n` +
        `Selected Payment Option: ${order.selectedPaymentOption}\n` +
        `Order Summary:\n`;

      const orderSummary = order.orderSummary.map((item) =>
        `Product Name: ${item.productName}\n` +
        `Price: UGX ${item.price}\n` +
        `Quantity: ${item.quantity}\n` +
        `Total: UGX ${item.total.toFixed(2)}\n`
      ).join("\n");

      const cartTotal = `Cart Total: UGX ${order.cartTotal.toFixed(2)}\n`; // Add cart total
      const shareText = `${orderText}${orderSummary}${cartTotal}`;
      const encodedShareText = encodeURIComponent(shareText);
      const whatsappURL = `https://wa.me/+256704435999?text=${encodedShareText}`;

      window.open(whatsappURL);
    });

    const orderDetails = document.createElement("ul");
    orderDetails.classList.add("order-details");

    for (const property in order) {
      if (property === "orderSummary") {
        const summaryList = document.createElement("ul");
        summaryList.classList.add("order-summary");

        order[property].forEach((item) => {
          const summaryItem = document.createElement("li");
          summaryItem.innerHTML = `
            <strong>Product Name:</strong> ${item.productName}<br>
            <strong>Price:</strong> UGX ${item.price}<br>
            <strong>Quantity:</strong> ${item.quantity}<br>
            <strong>Total:</strong> UGX ${item.total.toFixed(2)}
          `;
          summaryList.appendChild(summaryItem);
        });

        const summaryListItem = document.createElement("li");
        summaryListItem.innerHTML = "<strong>Order Summary:</strong>";
        summaryListItem.appendChild(summaryList);

        orderDetails.appendChild(summaryListItem);
      } else {
        const listItem = document.createElement("li");
        listItem.innerHTML = `<strong>${property}:</strong> ${order[property]}`;
        orderDetails.appendChild(listItem);
      }
    }

    orderContainer.appendChild(orderTitle);
    orderContainer.appendChild(shareButton);
    orderContainer.appendChild(orderDetails);

    // Send browser notification for new order
    if (sortedOrders[0] === sortedOrder) {
      if (Notification.permission === 'granted') {
        sendNotification(orderId, order);
      } else if (Notification.permission !== 'denied') {
        // Request permission from the user
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            sendNotification(orderId, order);
          }
        });
      }
    }

    // Append each order container at the beginning of the orders container
    ordersContainer.insertBefore(orderContainer, ordersContainer.firstChild);
  }
});

// Function to send the browser notification
function sendNotification(orderId, order) {
  const isMobileDevice = /Mobi|Android/i.test(navigator.userAgent);
  const notificationTitle = 'Divine Phones (New Order Placed)';
  const notificationOptions = {
    body: `Order ID: ${orderId}`,
    icon: 'img/Devine Phones.png' // Replace with the path to your notification icon
  };

  if (isMobileDevice) {
    // Use the `showNotification` method for mobile devices
    navigator.serviceWorker.ready.then(registration => {
      registration.showNotification(notificationTitle, notificationOptions);
    });
  } else {
    // Use the `Notification` constructor for desktop browsers
    if (Notification.permission === 'granted') {
      new Notification(notificationTitle, notificationOptions);
    } else if (Notification.permission !== 'denied') {
      // Request permission from the user
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          new Notification(notificationTitle, notificationOptions);
        }
      });
    }
  }
}


</script>
</body>
</html>
